<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Denylist</title>
    <style>
      body { font-family: "Times New Roman", serif; margin: 2rem; }
      h1 { margin-bottom: 0.5rem; }
      .section { margin-top: 2rem; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #333; padding: 0.4rem 0.6rem; text-align: left; }
      .warning { background: #ffe5cc; border: 1px solid #cc7a00; padding: 0.6rem; }
      .invalid { color: #b30000; font-weight: bold; }
      form.inline { display: inline; }
      label { margin-right: 0.5rem; }
      input[type="text"] { width: 280px; }
      textarea { width: 100%; min-height: 200px; font-family: "Courier New", monospace; }
    </style>
  </head>
  <body>
    <h1>Denylist</h1>
    <p><a href="/">Back to home</a></p>
    <p>Use categories to block entities and authors. Patterns are case-insensitive regex.</p>
    {% if invalid_patterns %}
    <div class="warning">
      Warning: invalid regex patterns detected. Fix or remove them.
    </div>
    {% endif %}

    <div class="section">
      <h2>Add entry</h2>
      <form method="post" action="/denylist/add">
        <label for="category">Category</label>
        <select name="category" id="category">
          {% for category in categories %}
          <option value="{{ category }}">{{ category }}</option>
          {% endfor %}
        </select>
        <label for="value">Value</label>
        <input type="text" name="value" id="value" />
        <button type="submit">Add</button>
      </form>
    </div>

    <div class="section">
      <h2>Current entries</h2>
      <table>
        <thead>
          <tr>
            <th>Category</th>
            <th>Value</th>
            <th>Action</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for category in categories %}
          {% for value in denylist[category] %}
          <tr>
            <td>{{ category }}</td>
            <td>{{ value }}</td>
            <td>
              <form class="inline" method="post" action="/denylist/remove">
                <input type="hidden" name="category" value="{{ category }}" />
                <input type="hidden" name="value" value="{{ value }}" />
                <button type="submit">Remove</button>
              </form>
            </td>
            <td>
              {% if category == "patterns" and value in invalid_patterns %}
              <span class="invalid">invalid regex</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="section">
      <h2>Edit raw JSON</h2>
      <form method="post" action="/denylist/save">
        <textarea name="raw_json">{{ raw_json }}</textarea>
        <div>
          <button type="submit">Save</button>
        </div>
      </form>
    </div>
  </body>
</html>
